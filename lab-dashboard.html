<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Laboratory Staff Dashboard</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css">
    <link rel="stylesheet" href="css/styles.css">
    <script type="module" src="js/firebase.js"></script> 
    <script type="module" src="js/auth.js" defer></script> 
    <script src="js/lab-sidebar.js" defer></script> 
    <script type="module" src="js/task-list.js" defer></script>
    <script type="module" src="js/lab-account.js" defer></script> 
    <script type="module" src="js/lab-home.js" defer></script> 
    <script type="module" src="js/lab-notification.js" defer></script> 
    <script type="module" src="js/lab-analysis-report.js" defer></script> 
    <script async src="https://docs.opencv.org/3.4.1/opencv.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.4.0/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.13/jspdf.plugin.autotable.min.js"></script>
   

</head>
<body>
     <!-- Header -->
     <header class="lab-header">
        <div class="header-content">
            <button id="openSidebar" class="sidebar-openbtn">&#9776;</button>
            <div class="admin-logo">
                <img src="images/logo.webp" alt="CNSRR Logo">
                <div class="admin-logo-text">
                    <h3>Center for Natural Sciences and</h3>
                    <h4>Resources Research</h4>
                    <p class="sub-name">Research Institute of Science and Technology</p>
                </div>
            </div>
        </div>
        
        <div class="header-icons">
            <button id="helpBtn"><i class="fa-solid fa-question-circle"></i></button>
            <button id="notificationsBtn" class="notifications-btn">
                <i class="fa-solid fa-circle-exclamation"></i>
                <span id="notificationCount" class="notification-count">0</span>
            </button>
            <button id="settingsBtn"><i class="fa-solid fa-gear"></i></button>
        </div>
    </header>
    
    
    <!-- Sidebar -->
    <div id="sidebar" class="lab-sidebar">

        <a href="#" id="dashboardLink" onclick="openTab(event, 'home')">
            <i class="fa-solid fa-home"></i> 
            <span class="lab-side">Dashboard </span>
        </a>
        <a href="#" id="requestListLink" onclick="openTab(event, 'taskList')">
            <i class="fa-solid fa-file"></i> 
            <span class="lab-side">Tasks Lists </span>
        </a>
        <a href="#" id="analysisReportLink" onclick="openTab(event, 'analysisReport')">
            <i class="fa-solid fa-clipboard-list"></i>
            <span class="lab-side">Analysis Report </span>
        </a>
        <a href="#" id="eventsLink" onclick="openTab(event, 'events')">
            <i class="fa-solid fa-bullhorn"></i> 
            <span class="lab-side">Events </span>
        </a>
        <a href="#" id="accountLink" onclick="openTab(event, 'account')">
            <i class="fa-solid fa-user"></i> 
            <span class="lab-side">Account </span>
        </a>
    </div>
    
 <!-- Page Content -->
 <div id="main">
        

        <div id="notificationPopup" class="notification-popup hidden">
            <div class="popup-header">
                <h3>Notifications</h3>
                <button id="closePopup" class="close-popup-btn">&times;</button>
            </div>
            <div id="notificationsList" class="popup-body">
                <p>No notifications available</p>
            </div>
        </div>

        <!-- Main Content -->
        <div id="content">
            
        </div>

        <!-- Tab Contents -->
        <div id="tabContents">
            <!-- Home Section -->
            <div id="home" class="tabcontent">
               
                
                <!-- Welcome message and current date -->
                <p id="welcomeMessage"></p>
                <p id="currentDate"></p>

                <!-- Task Overview Section -->
              <div id="taskOverview">
                <div class="task-count">
                    <p class="assigned">
                        <span id="assignedTasksCount" class="clickable">0</span>
                        <span class="task-label"><strong>Assigned Tasks</strong></span>
                    </p>
                    <p class="ongoing">
                        <span id="ongoingTasksCount" class="clickable">0</span>
                        <span class="task-label"><strong>Ongoing Tasks</strong></span>
                    </p>
                    <p class="processed">
                        <span id="processedTasksCount" class="clickable">0</span>
                        <span class="task-label"><strong>Processed Tasks</strong></span>
                    </p>
                    <p class="rejected">
                        <span id="rejectedTasksCount" class="clickable">0</span>
                        <span class="task-label"><strong>Rejected Tasks</strong></span>
                    </p>
                </div>
            </div>

                <!-- Recent Tasks Section -->
                <div id="recentTasks" class="task-overview">
                    <h3>Task Overview</h3>
                    <table>
                        <thead>
                            <tr>
                                <th>Date</th>
                                <th>Request No.</th>
                                <th>Service Type</th>
                                <th>Client Name</th>
                                <th>No. of Samples</th>
                                <th>Priority Level</th>
                                <th>Status</th>
                            </tr>
                        </thead>
                        <tbody id="recentTaskTableBody">
                           
                        </tbody>
                    </table>
                </div>
                

                <!-- Approaching Deadlines Section -->
              <div id="approachingDeadlines">
                <h3>Approaching Deadline</h3>
                <div class="approaching-deadlines-container">
                    
                </div>
            </div>


               <!-- Upcoming Events Section --> 
                <div id="upcomingEvents">
                    <h3>Upcoming Events</h3>
                    <div class="upcoming-events-list">
                        
                    </div>
                </div>

                <!-- Circular Progress Bar Section -->
                <div id="progressBarSection">
                    <h3>Task Progress</h3>
                    <div class="progress-circle">
                        <svg>
                            <circle class="progress-background" cx="50" cy="50" r="45"></circle>
                            <circle class="progress-foreground" cx="50" cy="50" r="45"></circle>
                        </svg>
                        <div class="progress-text" id="progressText">0% Total Finished</div>
                    </div>
                </div>                

            </div>
        </div>

            <!-- Tasks List Section -->
            <div id="taskList" class="tabcontent" style="display:none;">
                <div>
                <h2>Tasks List</h2>
                <p>This is the tasks list section. List of all tasks assigned will appear here.</p>
                </div>
                <!-- Task Category Buttons -->
                <div class="task-buttons" style="border-bottom: 2px solid black; margin-bottom: 2vh;">
                    <button id="allAssignedBtn">All Assigned</button>
                    <button id="ongoingTasksBtn">Ongoing Tasks</button>
                    <button id="processedTasksBtn">Processed Tasks</button>
                    <button id="rejectedTasksBtn">Rejected Tasks</button>
                </div>

                <script>
                    // JavaScript code to toggle active button state
                    const taskButtons = document.querySelectorAll('.task-buttons button');
                    
                    taskButtons.forEach(button => {
                        button.addEventListener('click', function() {
                            taskButtons.forEach(btn => btn.classList.remove('active'));
                            this.classList.add('active');
                            // Additional logic to show/hide task content can be added here
                        });
                    });
                </script>

                <!-- Placeholder for Task Content -->
                <div id="taskContent">
                    <div id="taskListContainer">
                        <div id="allAssigned" class="task-placeholder hidden">
                            <table id="taskTable">
                                <thead>
                                    <tr>
                                        <th>Deadline</th>
                                        <th>Request ID</th>
                                        <th>Service Type</th>
                                        <th>Client Type</th>
                                        <th>Client Name</th>
                                        <th>No. of Samples</th>
                                        <th>Priority Level</th>
                                        <th>Status</th>
                                    </tr>
                                </thead>
                                <tbody id="taskTableBody">
                                    <!-- Task rows will be dynamically added here -->
                                </tbody>
                            </table>
                            <button id="addToOngoingButton" class="hidden">Add to Ongoing</button>
                        </div>

                        <div id="ongoing" class="task-placeholder hidden">
                            <div class="filter-buttons">
                                <button id="filterHighPriority">Priority</button>
                                <span class="separator"></span>
                                <button id="filterMicrobialTesting">Microbial Testing</button>
                                <span class="separator"></span>
                                <button id="filterMicrobialAnalysis">Microbial Analysis</button>
                                <span class="separator"></span>
                                <button id="filterLabResearchProcesses">Laboratory & Research Processes</button>
                            </div>

                            <script>
                                // JavaScript code to toggle active button state
                                const filterButtons = document.querySelectorAll('.filter-buttons button');
                                
                                filterButtons.forEach(button => {
                                    button.addEventListener('click', function() {
                                        filterButtons.forEach(btn => btn.classList.remove('active'));
                                        this.classList.add('active');
                                        // Additional logic for filtering can be added here
                                    });
                                });
                            </script>

                            <table id="ongoingTaskTable">
                                <thead>
                                    <tr>
                                        <th>Deadline</th>
                                        <th>Request ID</th>
                                        <th>Service Type</th>
                                        <th>Client Type</th>
                                        <th>Client Name</th>
                                        <th>No. of Samples</th>
                                        <th>Priority Level</th>
                                        <th>Status</th>
                                    </tr>
                                </thead>
                                <tbody id="ongoingTaskTableBody">
                                    <!-- Ongoing task rows will be dynamically added here -->
                                </tbody>
                            </table>
                        </div>
                        
                        <div id="processed" class="task-placeholder hidden">
                            <div class="filter-buttons">
                                <button id="filterHighPriorityProcessed">Priority</button>
                                <span class="separator"></span>
                                <button id="filterMicrobialTestingProcessed">Microbial Testing</button>
                                <span class="separator"></span>
                                <button id="filterMicrobialAnalysisProcessed">Microbial Analysis</button>
                                <span class="separator"></span>
                                <button id="filterLabResearchProcessesProcessed">Laboratory & Research Processes</button>
                            </div>
                            
            
                            <script>
                                // JavaScript code to toggle active button state
                                const filterButtonsP = document.querySelectorAll('.filter-buttons button');
                                
                                filterButtonsP.forEach(button => {
                                    button.addEventListener('click', function() {
                                        filterButtonsP.forEach(btn => btn.classList.remove('active'));
                                        this.classList.add('active');
                                        // Additional logic for filtering can be added here
                                    });
                                });
                            </script>

                            <table id="processedTaskTable">
                                <thead>
                                    <tr>
                                        <th>Deadline</th>
                                        <th>Request ID</th>
                                        <th>Service Type</th>
                                        <th>Client Type</th>
                                        <th>Client Name</th>
                                        <th>No. of Samples</th>
                                        <th>Priority Level</th>
                                        <th>Status</th>
                                    </tr>
                                </thead>
                                <tbody id="processedTaskTableBody">
                                    <!-- Processed task rows will be dynamically added here -->
                                </tbody>
                            </table>
                        </div>

                        <div id="rejected" class="task-placeholder hidden">
                        <div class="filter-buttons">
                            <button id="filterHighPriorityRejected">Priority</button>
                            <span class="separator"></span>
                            <button id="filterMicrobialTestingRejected">Microbial Testing</button>
                            <span class="separator"></span>
                            <button id="filterMicrobialAnalysisRejected">Microbial Analysis</button>
                            <span class="separator"></span>
                            <button id="filterLabResearchProcessesRejected">Laboratory & Research Processes</button>
                        </div>

                        <script>
                            // JavaScript code to toggle active button state
                            const filterButtonsR = document.querySelectorAll('.filter-buttons button');
                            
                            filterButtonsR.forEach(button => {
                                button.addEventListener('click', function() {
                                    filterButtonsR.forEach(btn => btn.classList.remove('active'));
                                    this.classList.add('active');
                                    // Additional logic for filtering can be added here
                                });
                            });
                        </script>

                        <table id="rejectedTaskTable">
                            <thead>
                                <tr>
                                    <th>Deadline</th>
                                    <th>Request ID</th>
                                    <th>Service Type</th>
                                    <th>Client Type</th>
                                    <th>Client Name</th>
                                    <th>No. of Samples</th>
                                    <th>Priority Level</th>
                                    <th>Status</th>
                                </tr>
                            </thead>
                            <tbody id="rejectedTaskTableBody">
                                <!-- Rejected task rows will be dynamically added here -->
                            </tbody>
                        </table>
                    </div>
                    </div>
                </div>

            </div>

            <div id="sampleDurationSection" style="display: none;">
                <h2>Sample's Duration</h2>
                <div class="duration-container">
                    <!-- Plus Button to Add Days -->
                    <button id="addDayButton">+ Add Day</button>
                </div>
                <button id="backSampleDuration">Back</button>
            </div>

            <div id="colonyCountSection" style="display: none;">
                <h2>Bacterial Colony Detection</h2>
                <h2 id="colonyCountHeader"></h2>
                <p id="status">OpenCV.js is loading...</p>

                <div>
                <label for="blurSize">Gaussian Blur Size (odd number):</label>
                <input type="number" id="blurSize" value="5" min="1" step="2" />
                
                <label for="threshBlockSize">Threshold Block Size (odd number):</label>
                <input type="number" id="threshBlockSize" value="11" min="3" step="2" />
                
                <label for="threshC">Threshold C Value:</label>
                <input type="number" id="threshC" value="2" step="0.1" />
                
                <label for="minColonySize">Min Colony Size:</label>
                <input type="number" id="minColonySize" value="60" min="1" step="1" />
                
                <label for="maxColonySize">Max Colony Size:</label>
                <input type="number" id="maxColonySize" value="5000" min="1" step="1" />
                </div>

                <p><strong>Total Colony Count: <span id="colonyCount">0</span></strong></p>

                <div>
                <div class="inputoutput">
                    <img id="imageSrc" alt="No Image" />
                    <div class="caption">imageSrc <input type="file" id="fileInput" name="file" /></div>
                </div>
                <div class="inputoutput">
                    <canvas id="canvasOutput"></canvas>
                    <div class="caption">canvasOutput</div>
                </div>
                </div>

                <div class="colony-list" id="colonyList">
                <!-- Colony IDs and validation options will be added here -->
                </div>

                <button id="saveColonyCountBtn">Save Colony Count</button>
                <button id="backToSampleDuration">Back</button>
            </div>

            <!-- Placeholder for dynamic report form -->
            <div id="reportFormContainer" style="display:none;"></div>

            <div id="reportContainer" style="display: none;"></div>

            <!-- Task Details Section (initially hidden) -->
            <div id="taskDetailsSection" style="display:none;">
                <h3 id="taskHeader"></h3>
                <table id="sampleTable">
                    <thead>
                        <tr>
                            <th>Sample No.</th>
                            <th>Status</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="sampleTableBody">
                        <!-- Sample rows will be dynamically added here -->
                    </tbody>
                </table>
                <button id="backToTasksButton">Back to Ongoing Tasks</button>
                <button id="createReportButton">Create Full Report</button>
            </div>

        </div>
            </div>
                             

            <!-- Analysis Reports Section -->
            <div id="analysisReport" class="tabcontent" style="display:none; margin-left: 250px;">
                <div style="border-bottom: 2px solid black;">
                <h2>Analysis Reports</h2>
                    <div class="analysis-reports-header">
                        <p>This is the analysis reports section. All analysis reports will be shown here.</p>
                        <input type="text" id="searchBar" placeholder="Search by Request ID or Client Name" oninput="filterAnalysisReports()">
                    </div>
                </div>
                <table id="analysisReportTable">
                    <thead>
                        <tr>
                            <th>Deadline</th>
                            <th>Request ID</th>
                            <th>Service Type</th>
                            <th>Client Type</th>
                            <th>Client Name</th>
                            <th>No. of Samples</th>
                            <th>Priority Level</th>
                            <th>Status</th>
                        </tr>
                    </thead>
                    <tbody id="analysisReportTableBody">
                        <!-- Analysis report rows will be dynamically added here -->
                    </tbody>
                </table>
            </div>
            

            <!-- Events Section -->
            <div id="events" class="tabcontent hidden" style="margin-left: 250px;">
                <div class="events-header">
                    <h2>Events and Activities</h2>
                    <input type="text" id="eventSearch" placeholder="Search Events..." style="margin-left: 20px;">
                </div>

                <div id="eventContainer" class="scroll-container">
                    <!-- Scrollable event list will be rendered here -->
                </div>
            </div>

            <!-- Event Details Modal -->
            <div id="eventDetailsModal" class="modal" style="display: none;">
                <div class="modal-content" style="margin-left: 500px; width: 50%; margin-top: 125px;">
                    <span class="close">&times;</span>
                    <img id="eventImageModal" src="" alt="Event Image" style="width: 100%; height: 100%; object-fit: contain; padding: 10px; border-radius: 10px;">
                    <h3 id="eventTitleModal"></h3>
                    <p id="eventDescriptionModal"></p>
                </div>
            </div>

            <!-- Account Section -->
            <div id="account" class="tabcontent" style="display:none; margin-left: 220px; margin-top: 0px;">
                <div class="labaccount">
                    <h1 class="accproflabel">Account Profile</h1>
                    <div class="adminprofile">
                    <h2 class="profinfolabel">Profile Information</h2>
                
                    <div class="accountinfo">
                    <!-- Full Name and Account Number (Header) -->
                    <div class="account-header">
                        <!-- Profile picture placeholder -->
                        <div class="profile-picture-container">
                            <img id="profilePicture" class="profile-picture" src="default-avatar.png" alt="Profile Picture">
                            <input type="file" id="profilePictureInput" accept="image/*" style="display: none;">
                        </div>
                    
                        <!-- Account Details -->
                        <div class="account-details">
                            <span id="fullName" class="full-name"></span>
                            <p class="account-number" id="accountNumber"></p>
                            <div class="role-bubble">
                                Laboratory Staff
                            </div>
                        </div>
                    </div>
                
                    <!-- Account Details Bubbles -->
                    <div class="account-details">
                        <div class="detail-bubble"><p class="accdeetslbl">Full Name:</p> <span id="fullNameDetail"></span></div>
                        <div class="detail-bubble"><p class="accdeetslbl">Address:</p>  <span id="address"></span></div>
                        <div class="detail-bubble"><p class="accdeetslbl">Contact Number:</p>  <span id="contactNumber"></span></div>
                        <div class="detail-bubble"><p class="accdeetslbl">Username:</p>  <span id="username"></span></div>
                    </div>
                
                    <!-- Edit Button -->
                    <button id="editAccountBtn" class="edit-btn">Edit</button>
                </div>
                </div>
                </div>
            </div>            

            <div id="editModal" class="modal">
                <div class="modal-content" style="margin-bottom: 125px; margin-top: 125px; display:flex;flex-direction: column;">
                    <span class="close">&times;</span>
                    <h2>Edit Account Details</h2>
                
                    <div style="display: flex;align-items: center;justify-content: space-between;">
                        <div style="display: flex;flex-direction: column;width: 30%;">
                            <label for="editFirstName">First Name:</label>
                            <input type="text" id="editFirstName" placeholder="First Name">
                        </div>
                        <div style="display: flex;flex-direction: column;width: 30%;">
                            <label for="editMiddleName">Middle Name:</label>
                            <input type="text" id="editMiddleName" placeholder="Middle Name">
                        </div>
                        <div style="display: flex;flex-direction: column;width: 30%;">
                            <label for="editLastName">Last Name:</label>
                            <input type="text" id="editLastName" placeholder="Last Name">
                        </div>
                    </div>

                    <label for="editUsername">Username:</label>
                    <input type="text" id="editUsername" placeholder="Username">
                
                    <label for="editAddress">Address:</label>
                    <input type="text" id="editAddress" placeholder="Address">
                
                    <label for="editContactNumber">Contact Number:</label>
                    <input type="text" id="editContactNumber" placeholder="Contact Number">
                
                    <button id="saveChangesBtn">Save Changes</button>
                </div>                
            </div>
            
        </div>
    </div>

    <div id="lab-error-message" class="hidden">
        <p>You are not authorized to view this page or an error occurred. Redirecting to login...</p>
    </div>

    <script type="module" src="js/lab-events.js" defer></script> 
    <script type="text/javascript" src="js/colony-count.js"></script>
</body>
</html>
